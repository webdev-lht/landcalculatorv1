<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Land Purchase Cost</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="bg-light">

    <!-- Header -->
    <nav class="navbar lime-header bg-dark px-3">
        <div class="container-fluid text-white">
        <a href="00b.dashboard.html" class="btn btn-sm btn-outline-light me-2">‚Üê Back</a>
        <span class="navbar-brand mb-0 h6 text-white">Utility Connection Cost</span>
        </div>
    </nav>

    <!--- Picked Property Details --->
    <div class="mb-3 bg-light border rounded small p-2">
        <div><strong>Address:</strong> <span id="summaryAddress">Loading...</span></div>
        <div><strong>Parcel ID:</strong> <span id="summaryParcelID">Loading...</span></div>
        <div><strong>Coordinates:</strong> <span id="summaryCoords">Loading...</span></div>
    </div>

    <div class="container my-5">

      <!-- Water -->
      <div class="mb-4">
        <h6 class="fw-bold">Water Source</h6>
        <div class="row g-2 align-items-end">
          <div class="col-md-4">
            <label class="form-label">Type</label>
            <select id="waterSource" class="form-select">
              <option selected disabled>Choose Water Source</option>
              <option value="public">Public Utility Water</option>
              <option value="well">Private Water Well</option>
              <option value="co-op">Water Co-op</option>
              <option value="haul">Water Hauling (Tank Storage)</option>
            </select>
          </div>
          <div class="col-md-2">
            <label class="form-label">Number</label>
            <input type="number" id="waterNumber" class="form-control" min="0">
          </div>
          <div class="col-md-3">
            <label class="form-label">Unit Cost ($)</label>
            <input type="number" id="waterUnitCost" class="form-control" min="0" step="0.01" value="23220">
          </div>
          <div class="col-md-3">
            <label class="form-label">Subtotal ($)</label>
            <input type="text" id="waterSubtotal" class="form-control" readonly>
          </div>
        </div>
      </div>

      <!-- Sewer -->
      <div class="mb-4">
        <h6 class="fw-bold">Sewer System</h6>
        <div class="row g-2 align-items-end">
          <div class="col-md-4">
            <label class="form-label">Type</label>
            <select id="sewerSystem" class="form-select">
              <option selected disabled>Choose Wastewater System</option>
              <option value="septic">Septic Tank (Conventional)</option>
              <option value="aerobic">Aerobic OSSF</option>
              <option value="mound">Mound System</option>
              <option value="public">Public Sewer</option>
              <option value="composting">Composting Toilet</option>
            </select>
          </div>
          <div class="col-md-2">
            <label class="form-label">Number</label>
            <input type="number" id="sewerNumber" class="form-control" min="0">
          </div>
          <div class="col-md-3">
            <label class="form-label">Unit Cost ($)</label>
            <input type="number" id="sewerUnitCost" class="form-control" min="0" step="0.01" value="13100">
          </div>
          <div class="col-md-3">
            <label class="form-label">Subtotal ($)</label>
            <input type="text" id="sewerSubtotal" class="form-control" readonly>
          </div>
        </div>
      </div>

      <!-- Power -->
      <div class="mb-4">
        <h6 class="fw-bold">Power Supply</h6>
        <div class="row g-2 align-items-end">
          <div class="col-md-4">
            <label class="form-label">Type</label>
            <select id="powerSource" class="form-select">
              <option selected disabled>Choose Power Source</option>
              <option value="public">Grid Connection</option>
              <option value="solar">Off-Grid Solar</option>
              <option value="generator">Diesel Generator</option>
              <option value="hybrid">Hybrid</option>
              <option value="electricmeter">Electric Meter</option>
            </select>
          </div>
          <div class="col-md-2">
            <label class="form-label">Number</label>
            <input type="number" id="powerNumber" class="form-control" min="0">
          </div>
          <div class="col-md-3">
            <label class="form-label">Unit Cost ($)</label>
            <input type="number" id="powerUnitCost" class="form-control" min="0" step="0.01" value="7840">
          </div>
          <div class="col-md-3">
            <label class="form-label">Subtotal ($)</label>
            <input type="text" id="powerSubtotal" class="form-control" readonly>
          </div>
        </div>
      </div>

      <!-- Gas -->
      <div class="mb-4">
        <h6 class="fw-bold">Gas Source</h6>
        <div class="row g-2 align-items-end">
          <div class="col-md-4">
            <label class="form-label">Type</label>
            <select id="gasType" class="form-select">
              <option selected disabled>Choose Gas Supply</option>
              <option value="propane">Propane Tank</option>
              <option value="natural">Natural Gas Line</option>
              <option value="none">None</option>
            </select>
          </div>
          <div class="col-md-2">
              <label class="form-label">Number</label>
              <input type="number" id="gasNumber" class="form-control" min="0">
            </div>
          <div class="col-md-3">
            <label class="form-label">Unit Cost ($)</label>
            <input type="number" id="gasUnitCost" class="form-control" min="0" step="0.01" value="2800">
          </div>
          <div class="col-md-3">
            <label class="form-label">Subtotal ($)</label>
            <input type="text" id="gasSubtotal" class="form-control" readonly>
          </div>
        </div>
      </div>

      <!-- Phone -->
      <div class="mb-4">
        <h6 class="fw-bold">Phone Service</h6>
        <div class="row g-2 align-items-end">
          <div class="col-md-4">
            <label class="form-label">Type</label>
            <select id="phoneType" class="form-select">
              <option selected disabled>Choose Phone Type</option>
              <option value="landline">Landline</option>
              <option value="cell">Cellular</option>
              <option value="none">None</option>
            </select>
          </div>
          <div class="col-md-2">
              <label class="form-label">Number</label>
              <input type="number" id="phoneNumber" class="form-control" min="0">
            </div>
          <div class="col-md-3">
            <label class="form-label">Unit Cost ($)</label>
            <input type="number" id="phoneUnitCost" class="form-control" min="0" step="0.01" value="150">
          </div>
          <div class="col-md-3">
            <label class="form-label">Subtotal ($)</label>
            <input type="text" id="phoneSubtotal" class="form-control" readonly>
          </div>
        </div>
      </div>

      <!-- Internet -->
      <div class="mb-4">
        <h6 class="fw-bold">Internet Service</h6>
        <div class="row g-2 align-items-end">
          <div class="col-md-4">
            <label class="form-label">Type</label>
            <select id="internetType" class="form-select">
              <option selected disabled>Choose Internet Source</option>
              <option value="fiber">Fiber Optic</option>
              <option value="dsl">DSL / Wired</option>
              <option value="satellite">Satellite</option>
              <option value="cellular">Mobile Data</option>
              <option value="none">None</option>
            </select>
          </div>
          <div class="col-md-2">
              <label class="form-label">Number</label>
              <input type="number" id="internetNumber" class="form-control" min="0">
            </div>
          <div class="col-md-3">
            <label class="form-label">Unit Cost ($)</label>
            <input type="number" id="internetUnitCost" class="form-control" min="0" step="0.01" value="450">
          </div>
          <div class="col-md-3">
            <label class="form-label">Subtotal ($)</label>
            <input type="text" id="internetSubtotal" class="form-control" readonly>
          </div>
        </div>
      </div>

      <hr />
          <div class="mb-3">
              <label class="form-label fw-bold">Total Utility Connection Cost</label>
              <input type="text" id="totalUtilityConnectionCost" class="form-control readonly-input fw-bold" readonly />
            </div>

          <button id="totalResult" class="btn btn-dark" style="max-width: 180px; margin: 20px;" onclick="saveAndContinue()">Save</button>
      </div>

      <!-- Total Section (Inside the scrollable area) -->
          <hr />      

            <div class="d-flex justify-content-between gap-2 mb-3">
              <a href="./02sitedevelopmentcost.html" class="btn btn-outline-secondary w-100">‚¨ÖÔ∏è Previous Step</a>
              <a href="./04buildingprepartioncost.html" class="btn btn-outline-secondary w-100">Next Step ‚û°Ô∏è</a>
            </div>

            <div class="d-grid gap-2 mb-5">
              <a href="00b.dashboard.html" class="btn btn-dark">üè† Back to Cost Dashboard</a>
              <a href="./09finalstep.html" class="btn btn-outline-dark">‚úÖ Review Your Estimate with LHT</a>
            </div>
            </div> <!-- This closes #formScrollableArea -->
      </div>
    </div>

    <script>
      // Load from localStorage and display selected parcel info
      const address = localStorage.getItem("parcelAddress") || "N/A";
      const parcelID = localStorage.getItem("parcelID") || "N/A";
      const lat = localStorage.getItem("latitude") || "N/A";
      const lng = localStorage.getItem("longitude") || "N/A";

      document.getElementById("summaryAddress").textContent = address;
      document.getElementById("summaryParcelID").textContent = parcelID;
      document.getElementById("summaryCoords").textContent = `${lat}, ${lng}`;
    </script>

    <script>
      function computeUtilityCosts() {
        const ids = ["water", "sewer", "power", "gas", "phone", "internet"];
        let total = 0;

        ids.forEach((id) => {
          const numberEl = document.getElementById(`${id}Number`);
          const unitEl = document.getElementById(`${id}UnitCost`);
          const subtotalEl = document.getElementById(`${id}Subtotal`);

          const number = parseFloat(numberEl?.value) || 0;
          const unit = parseFloat(unitEl?.value) || 0;
          const subtotal = number * unit;

          if (subtotalEl) subtotalEl.value = `$${subtotal.toFixed(2)}`;
          total += subtotal;
        });

        const totalField = document.getElementById("totalUtilityConnectionCost");
        if (totalField) {
          totalField.value = `$${total.toFixed(2)}`;
          localStorage.setItem("utilityConnectionCost", total.toFixed(2));
        }
      }

      function saveAndContinue() {
        if (e) e.preventDefault();
        computeUtilityCosts();
        alert("Utility Connection Cost saved!");
        return false;
        
      }

      ["water", "sewer", "power", "gas", "phone", "internet"].forEach((id) => {
        document.getElementById(`${id}Number`)?.addEventListener("input", computeUtilityCosts);
        document.getElementById(`${id}UnitCost`)?.addEventListener("input", computeUtilityCosts);
        document.getElementById(`${id}Type`)?.addEventListener("change", computeUtilityCosts);
      });

      window.onload = computeUtilityCosts;
    </script>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
